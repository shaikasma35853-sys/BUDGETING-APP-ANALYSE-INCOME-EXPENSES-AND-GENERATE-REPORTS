{% extends 'base.html' %}
{% block content %}
<div class="d-flex align-items-center mb-3">
  <h4 class="me-auto">Report — {{ period }}</h4>
  <a class="btn btn-outline-secondary" href="{{ url_for('core.report_pdf', period=period) }}">Export PDF</a>
</div>
<div class="row g-3">
  <div class="col-md-4"><div class="card card-metric"><div class="card-body"><div class="text-muted">Income</div><div class="h3">₹ {{ summary.income }}</div></div></div></div>
  <div class="col-md-4"><div class="card card-metric"><div class="card-body"><div class="text-muted">Expense</div><div class="h3">₹ {{ summary.expense }}</div></div></div></div>
  <div class="col-md-4"><div class="card card-metric"><div class="card-body"><div class="text-muted">Balance</div><div class="h3">₹ {{ summary.balance }}</div></div></div></div>
</div>
<div class="row mt-3">
  <div class="col-lg-6"><div class="card"><div class="card-header">Top 3 Overspends</div><div class="card-body">
    {% if summary.top3 %}<ul class="mb-0">{% for k,v in summary.top3.items() %}<li>{{ k }} — ₹ {{ v }}</li>{% endfor %}</ul>{% else %}<p class="text-muted">No expenses this month.</p>{% endif %}
  </div></div></div>
  <div class="col-lg-6"><div class="card"><div class="card-header">Budget Variance</div><div class="card-body">
    {% if summary.variance %}
    <table class="table table-sm"><thead><tr><th>Category</th><th class="text-end">Spent</th><th class="text-end">Budget</th><th class="text-end">Δ</th></tr></thead>
      <tbody>{% for v in summary.variance %}<tr><td>{{ v.category }}</td><td class="text-end">{{ v.spent }}</td><td class="text-end">{{ v.budget }}</td>
        <td class="text-end {% if v.delta>0 %}text-danger{% else %}text-success{% endif %}">{{ v.delta }}</td></tr>{% endfor %}</tbody>
    </table>
    {% else %}<p class="text-muted">No budgets set for this period.</p>{% endif %}
  </div></div></div>
</div>
<h5 class="mt-4">Transactions</h5>
<table class="table table-sm table-hover"><thead class="table-light"><tr><th>Date</th><th>Description</th><th>Category</th><th class="text-end">Amount</th></tr></thead>
  <tbody>{% for r in rows %}{% if r.type=='expense' %}<tr><td>{{ r.date }}</td><td>{{ r.desc }}</td><td>{{ r.category }}</td><td class="text-end">{{ r.amount }}</td></tr>{% endif %}{% endfor %}</tbody>
</table>
{% endblock %}
